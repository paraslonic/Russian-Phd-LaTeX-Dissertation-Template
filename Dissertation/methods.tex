\chapter{Материалы и методы}
\subsection{Отбор последовательностей геномов}
Для анализа геномной изменчивости \textit{E. coli} мы использовали 327 геномов данного организма доступные в базе RefSeq на момент ноября 2017 года и собранных до уровня репликонов ("финишированная"\ сборка). Для анализа изменчивости в различных филогруппах \textit{E. coli} нами были отобраны пять геномов от представителей наиболее крупных филогрупп (подбор проводился на основе литературных данных). Затем для каждого представителя были выбраны 100 наиболее близких по геномов, доступных в базе RefSeq. В качестве меры сходства последовательностей мы использовали суммарную ширину выравниваненных фрагментов генома, выравнивание проводилось программой nucmer \cite{marccais2018mummer4}. 

Для анализа внутривидовых структур у \textit{Pseudomonas aeruginosa}, \textit{Pseudomonas fluorescens} и \textit{Neisseria gonorrhoeae} нами были выгружены все полногеномные последовательности, доступные в RefSeq. Для каждого вида в отдельности было построено филогенетическое дерево при помощи утилиты ParSNP v1.2 \cite{treangen2014harvest}. На основании полученных филогенетических деревьев мы выбрали (визуальным анализом, основываясь на количестве геномов и изолированности от иных клад) от двух до четырех клад дерева. 

Для анализа других видов прокариот мы собрали набор последовательностей геномов всех видов, для которых было доступно не менее 50 последовательностей геномов в базе данных RefSeq. При наличии более 100 последовательностей геномов, в анализ включались 100 случайно выбранных последовательностей. Таким образом была сформирована выборка из 143 видов прокариот, включая два вида архей.

\subsection{Анализ геномной вариабельности}
Белок-кодирующие последовательности во всех загруженных геномах были аннотированы с помощью программы Prokka ver 1.11 \cite{seemann2014prokka}. Гены были отнесены к ортогруппам с помощью OrthoFinder ver. 2.2.6 \cite{emms2015orthofinder}. 

Скрипты на языке Python, содержащиеся в приложении GCB (https://gcb.rcpcm.org/), использовались для оценки уровня изменчивости генома и создания подграфов вокруг интересующих областей генома. Принципы их работы описаны в соответствующих разделах главы Результаты. В разработке приложения приняли участие: Конанов Д.Н., Федоров Д.Е., Верещагин Р.И.. 

Визуализация подграфов проводилась в программе Cytoscape \cite{smoot2011cytoscape}. Для формализации определения областей генома с повышенной изменчивостью мы использовали критерий Тьюки, основанный на межквартильном расстоянии.

Статистическая обработка и визуализация данных мы проводили на языке R. Для определения коэффициентов корреляции Спирмена использовали функцию \textit{cor}. Статистическая значимость корреляций определялась при помощи функции \textit{cor.test}. Индексы согласованности признаков с филогенетическим деревом (retention index) рассчитывались с использованием функции RI из библиотеки phangorn для языка R. Для построения линейных моделей использовалась функция \textit{lm} языка R.

Для построения филогенетического дерева различных видов рода \textit{Bacillus} мы выровняли транслированные последовательности всех ортологичных однокопийных генов при помощи программы muscle \cite{edgar2004muscle}, преобразовали их в выравнивания кодонов с помощью pal2nal и построили дерево с помощью iqtree v1.6 \cite{nguyen2015iq} с опцией ModelFinder Plus (оптимальный подбор эволюционной модели); конвейер snakemake для этих шагов доступен по адресу https://github.com/paraslonic/orthosnake/blob/tree/Snakefile\_tree. 

Поиск областей синтении мы проводили с помощью программы nucmer \cite{marccais2018mummer4}(при сравнении последовательностей геномов различных штаммов одного вида), либо программы Mauve \cite{darling2004mauve} (при сравнении последовательностей геномов принадлежащих различным видам).

Для определения профагов в геномах мы использовали онлайн сервис Phaster \cite{arndt2016phaster}. 

Для \textit{E. coli} мы использовали нормированную матрицу контактов из работы \cite{lioy2018multiscale} и доступную в репозитории: \url{https://github.com/koszullab/E_coli_analysis/tree/master/data}. Для \textit{B. subtilis} мы использовали матрицу контактов из статьи \cite{marbouty2015condensin}. Для нормировки матрицы хромосомных контактов использовалась функция  \textit{normalizeCore.performIterativeCorrection} из библиотеки gcMapExplorer \url{https://github.com/rjdkmr/gcMapExplorer}, количество итераций равнялось 1000, значение шага составило 0.00001. Для построения линейных моделей использовалась функция \textit{lm} языка R.

\section{Сборка и анализ геномов \textit{E. coli} от пациентов с болезнью Крона}

\subsection{Группа пациентов и клинический материал}
Пациенты были отобраны из двух клинических центров (ЦНИИ гастроэнтерологии и Государственного научного центра колопроктологии) в Москве, Российская Федерация, с 2012 по 2014 год. В исследование были включены десять пациентов. Критерии включения были следующими: возраст старше 18 лет, болезнь Крона была диагностирована эндоскопически и гистологически подтверждена. Критериями исключения были признаки неопределенного колита, инфекционные заболевания, недавнее лечение антибиотиками. 
Для исследования были собраны три типа образцов: 1) образцы кала; 2) биопсийный материал, полученный в ходе эндоскопического исследования; 3) жидкое содержимое подвздошной кишки. В подборе пациентов и организации сбора материала принимали участие: Щербаков П.Л., Маев И.В., Павленко А.В., Андреев Д.Н., Халиф И.Л..

\subsection{Выделение изолятов \textit{E. coli}}

Выделение \textit{E. coli} выполняли следующим образом. Приблизительно 0,05 мл объема фекалий помещали в 0,5 мл стерильного буфера (PBS), перемешивали на вортексе до гомогенности, аликвоту разбавляли примерно в $10^6$ раз. Затем 0,1 мл полученной жидкости наносили на чашки со средой LB. После инкубации в течение ночи при 37$^\circ$C изолированные колонии идентифицировали с помощью программного обеспечения Matrix Assisted Laser Desorbtion / Ionization (MALDI) Biotyper (Bruker Daltonics, Германия) с использованием масс-спектрометра Microflex LT (Bruker Daltonics, Германия). Для экстракции ДНК все штаммы \textit{E. coli} выращивали в бульоне LB при 37$^\circ$C при встряхивании (200 об/мин) в течение ночи и собирали центрифугированием. 

\subsection{Экстракция ДНК и геномное секвенирование}

Геномную ДНК из отдельных культур экстрагировали с помощью набора QIAamp DNA Mini (Qiagen) в соответствии с протоколом производителя. Экстрагированная ДНК (100 нг для каждого образца) была разрушена на фрагменты размером 200 – 300 пар нуклеотидов с помощью системы Covaris S220 (Covaris, Woburn, Massachusetts, USA). Эмульсию ПЦР проводили с помощью набора Ion PGM Template OT2 200 (Life Technologies). Секвенирование ДНК выполняли с помощью Ion Torrent PGM (Life Technologies) с чипом Ion 318 и набором Ion PGM Sequencing 200 v2 (Life Technologies). 

Получение культур и секвенирование проводилось в геномном центре ФНКЦ ФХМ при участии Кострюковой Е.С., Бабенко В.В., Карповой И.Ю., Лисициной Е.С..

Всего было получено 28 геномных последовательностей \textit{E. coli} от 10 пациентов с болезнью Крона.

\subsection{Сборка генома, исправление ошибок в гомополимерных областях}
Последовательности генома были собраны с использованием программ Mira 4.0 \cite{chevreux1999genome} со стандартными параметрами и SPADES 3.10.0 \cite{bankevich2012spades}.

Каждая сборка проверялась на наличие возможных контаминаций (последовательностей нецелевого организма) при помощи скрипта, написанного на языке R и доступного по адресу: \url{https://github.com/paraslonic/BacPortrait/blob/master/portrait\_spades.r}. Данный скрипт отображает каждый контиг (отдельный фрагмент сборки) на диаграмме с ГЦ-составом и глубиной покрытия контига; дополнительно отображается информация о таксономической аннотации заданного числа контигов. 
 
Для технологии секвенирования Ion Torrent характерно наличие значительного количества ошибок в определении копийности нуклеотидов, особенно в гомополимерных областях. Для исправления данного типа ошибок, которые могут приводить к ошибкам сборки и искусственному сдвигу рамки считывания в кодирующих последовательностях (CDS), нами был разработан следующий метод. Проводилось картирование прочтений на сборку; поиск позиций с вставками либо делециями в картированных прочтениях при помощи утилиты VarScan; выравнивание областей сборки вокруг найденных позиций при помощи программы BLAST на базу nt (NCBI); выбор варианта последовательности, который соответствует лучшему выравниванию BLAST и представлен в прочтениях с частотой не ниже 25\%. Этот метод уменьшает количество артефактных мутаций в сборке примерно в 2,5 раза (оценка основана на сравнении сборок считываний Ion Torrent до и после исправления с считываниями более точных технологий секвенирования, таких как Illumina, SOLID и Sanger). Вычислительный конвейер для данной процедуры доступен по адресу: \url{www.github.com/paraslonic/HomoHomo}.

Последовательности геномов доступны в GenBank со следующими номерами доступа: RCE01 (JUDV00000000), RCE02 (JUDW00000000), RCE03 (JUDX00000000), RCE04 (JUDY00000000), RCE05 (JWJZ00000000), RCE06 (JWKA00000000), RKA00000000 (JWKA00000000), RKA000006 (JWKA00000000), RKA00000000 JWKB00000000), RCE08 (LAXB00000000), RCE10 (LAXA00000000), RCE11 (LAWZ00000000).

\subsection{Сбор внешних данных}
Для проведения анализа по поиску оперонов, чаще встречающихся в кишечных палочках, изолированных от пациентов с болезнью Крона по сравнению с изолятами, полученными от здоровых людей, мы также использовали внешние данные, собранные на основании анализа литературы. Геномы \textit{E. coli} изолированные от пациентов с болезнью Крона были взяты из работ \cite{nash2010genome, miquel2010complete, krause2011complete}. В группу контроля входили геномы, описанные как комменсальные или лабораторно культивируемые непатогенные штаммы (полный список доступен в публикации \cite{rakitina2017genome}).

\subsection{Поиск ортогрупп}
Полученные последовательности генома аннотировали с помощью программы PROKKA 1.7 \cite{seemann2014prokka}. Информация об оперонной структуре была получена из базы данных DOOR \cite{mao2014door}. Ортогруппы (группы гомологий включающие как ортологичные, так и паралогичные гены) были получены с помощью программы OrthoFinder v1.0.8 \cite{emms2015orthofinder} с параметрами по умолчанию. 

Статистический анализ представленности генов и оперонов в последовательностях генома комменсальных штаммов \textit{E. coli}, либо штаммов, полученных от пациентов с болезнью Крона, проводился при помощи скриптов на языке R, принцип работы которых описан ниже.

В организации анализа и интерпретации полученных результатов принимали участие: Говорун В.М., Ракитина Д.В., Гарушянц С.К..
